version: "2"

services:
  rak7391-backends:
    restart: unless-stopped
    image: encores/rak7391-backend:rak
    environment:
      - CHIRPSTACK_HOST=${CHIRPSTACK_HOST:-192.168.241.51:8080}
      - CHIRPSTACK_AUTH_USERNAME=${CHIRPSTACK_AUTH_USERNAME:-admin}
      - CHIRPSTACK_AUTH_PASSWORD=${CHIRPSTACK_AUTH_PASSWORD:-admin}

      - DATABASE_NAME=${DATABASE_NAME:-teapotlabs.db}

      - LORAWAN_NETWORK_HOST=${LORAWAN_NETWORK_HOST:-192.168.241.51}
      - LORAWAN_NETWORK_PORT=${LORAWAN_NETWORK_PORT:-1883}
      - LORAWAN_NETWORK_TOPIC=${LORAWAN_NETWORK_TOPIC:-/test/end-device/}

      - EXTERNAL_NETWORK_TYPE=${EXTERNAL_NETWORK_TYPE:-aws}
      - EXTERNAL_NETWORK_HOST=${EXTERNAL_NETWORK_HOST:-a2oaflbnxnqzb7-ats.iot.us-west-2.amazonaws.com}
      - EXTERNAL_NETWORK_PORT=${EXTERNAL_NETWORK_PORT:-1883}
      - EXTERNAL_NETWORK_TOPIC_DATA_OUT=${EXTERNAL_NETWORK_TOPIC_DATA_OUT:-testing/data/out/ac1f09fffe05f462}
      - EXTERNAL_NETWORK_TOPIC_DATA_IN=${EXTERNAL_NETWORK_TOPIC_DATA_IN:-testing/data/in}
      - EXTERNAL_NETWORK_ROOT_CERT=${EXTERNAL_NETWORK_ROOT_CERT:------BEGIN CERTIFICATE-----MIIDQTCCAimgAwIBAgITBmyfz5m/jAo54vB4ikPmljZbyjANBgkqhkiG9w0BAQsFADA5MQswCQYDVQQGEwJVUzEPMA0GA1UEChMGQW1hem9uMRkwFwYDVQQDExBBbWF6b24gUm9vdCBDQSAxMB4XDTE1MDUyNjAwMDAwMFoXDTM4MDExNzAwMDAwMFowOTELMAkGA1UEBhMCVVMxDzANBgNVBAoTBkFtYXpvbjEZMBcGA1UEAxMQQW1hem9uIFJvb3QgQ0EgMTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALJ4gHHKeNXjca9HgFB0fW7Y14h29Jlo91ghYPl0hAEvrAIthtOgQ3pOsqTQNroBvo3bSMgHFzZM9O6II8c+6zf1tRn4SWiw3te5djgdYZ6k/oI2peVKVuRF4fn9tBb6dNqcmzU5L/qwIFAGbHrQgLKm+a/sRxmPUDgH3KKHOVj4utWp+UhnMJbulHheb4mjUcAwhmahRWa6VOujw5H5SNz/0egwLX0tdHA114gk957EWW67c4cX8jJGKLhD+rcdqsq08p8kDi1L93FcXmn/6pUCyziKrlA4b9v7LWIbxcceVOF34GfID5yHI9Y/QCB/IIDEgEw+OyQmjgSubJrIqg0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNVHQ8BAf8EBAMCAYYwHQYDVR0OBBYEFIQYzIU07LwMlJQuCFmcx7IQTgoIMA0GCSqGSIb3DQEBCwUAA4IBAQCY8jdaQZChGsV2USggNiMOruYou6r4lK5IpDB/G/wkjUu0yKGX9rbxenDIU5PMCCjjmCXPI6T53iHTfIUJrU6adTrCC2qJeHZERxhlbI1Bjjt/msv0tadQ1wUsN+gDS63pYaACbvXy8MWy7Vu33PqUXHeeE6V/Uq2V8viTO96LXFvKWlJbYK8U90vvo/ufQJVtMVT8QtPHRh8jrdkPSHCa2XV4cdFyQzR1bldZwgJcJmApzyMZFo6IQ6XU5MsI+yMRQ+hDKXJioaldXgjUkK642M4UwtBV8ob2xJNDd2ZhwLnoQdeXeGADbkpyrqXRfboQnoZsG4q5WTP468SQvvG5-----END CERTIFICATE-----}
      - EXTERNAL_NETWORK_CERTIFICATE=${EXTERNAL_NETWORK_CERTIFICATE:------BEGIN CERTIFICATE-----MIIDWjCCAkKgAwIBAgIVAIcDQnL4qxbRAcfJ/FCRq2JukhO9MA0GCSqGSIb3DQEBCwUAME0xSzBJBgNVBAsMQkFtYXpvbiBXZWIgU2VydmljZXMgTz1BbWF6b24uY29tIEluYy4gTD1TZWF0dGxlIFNUPVdhc2hpbmd0b24gQz1VUzAeFw0yMzEwMjIxMjUwMDVaFw00OTEyMzEyMzU5NTlaMB4xHDAaBgNVBAMME0FXUyBJb1QgQ2VydGlmaWNhdGUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDsL5r5llLQuD+fgma/ofRBStE5nM4ll31BxAO2IKB/rGTnc7jbcnD7LiiDPmtN51qlwfW2GVuxP+jvTGo8OaPZlc0EMqrx19VRrVw8rma94HvGceMiIoEJBHTaqVkTyxi/hgTnpnehH9432r5udmGkS6y7uxcGUoR5yWWZ5G8WsK/r/XuhT9H2NKyMAVH+OBg5Z8gIiCqXreTJ1BSuRxjU7x89pQDyePHgEm/pixXGXGawdTSriE/ywkxEWegyuQ0dZGcHg/IarX1KXFbYpZ1q5daE0dn7HywmBk9araLEKQlmC1UNh4qHyTI9myZzAGmuLk1Ug268oADqbVpsWDwPAgMBAAGjYDBeMB8GA1UdIwQYMBaAFKtvFNbIYyuSFkHVc98abEtCwnECMB0GA1UdDgQWBBRyjKBj+DCN6lXDCo8GPx5hIGypTzAMBgNVHRMBAf8EAjAAMA4GA1UdDwEB/wQEAwIHgDANBgkqhkiG9w0BAQsFAAOCAQEAD8upKvq3CUzncLR6A493O1TA5anacWQJ3H3sLOQEOq+bVx35sSD7O/4Rdu9mBvNt7EUkHvcwmc8JrokTlu+caJ+S+lOmel4ZZKXmyFejI3YT2Np0FKY5CnHMqifBNFC/KI6ts3+Af1VS9yhKKVm2rQxKaQKz+0hkPwvTZZCRpT0k/NlNiYTW15hIvNBpbN6MFMIcpurfuR9NmM68oUb/NcRgaI0dvrLnrT1ibjsvs91A7kce6KJ1QaJZyLPe1ozhYXm44lb5/GRrIPEx33H71z/4MiqlQ+ugQizeTQnSZDj/tQfslX+t5ese07rbDlbjjMTbdhxv4elDINlGNavHPA==-----END CERTIFICATE-----}
      - EXTERNAL_NETWORK_PRIVATE_KEY=${EXTERNAL_NETWORK_PRIVATE_KEY:------BEGIN RSA PRIVATE KEY-----MIIEpAIBAAKCAQEA7C+a+ZZS0Lg/n4Jmv6H0QUrROZzOJZd9QcQDtiCgf6xk53O423Jw+y4ogz5rTedapcH1thlbsT/o70xqPDmj2ZXNBDKq8dfVUa1cPK5mveB7xnHjIiKBCQR02qlZE8sYv4YE56Z3oR/eN9q+bnZhpEusu7sXBlKEecllmeRvFrCv6/17oU/R9jSsjAFR/jgYOWfICIgql63kydQUrkcY1O8fPaUA8njx4BJv6YsVxlxmsHU0q4hP8sJMRFnoMrkNHWRnB4PyGq19SlxW2KWdauXWhNHZ+x8sJgZPWq2ixCkJZgtVDYeKh8kyPZsmcwBpri5NVINuvKAA6m1abFg8DwIDAQABAoIBAQC40uQOjkEOTjCTjUMEkSMH+RlTYU68ghil31McMdoHLwvjR16Qc7TQCqXvVmg4FWSNNAQo1R04zo9ku8KikGSU/7HoqBG3oTOwb94vKjcCPWn+t96LNr8NJGyhNEadw6ABOEocUNtqvfpycP32iTMNk55/Zf+1ldtPRnf4fpckA+07d0NdknxDM3r1pl0svaLT3zQ3O6ERYXf4/WdgcJD3mWbxQ9LS7yARI5Dbc9gVjuMO7K+RCE9hjO9nbMvIEzYfg4XevVNkKASBT3wjDnbBCXW1196HpGAVDC8Z42Pzm/CnT+nudZajV6kG32505cX9fnZX3T13pG7BAZxUluEpAoGBAPe4233TJmJFtRD1legUiKKmIWDe2D+Qb9dKcsbu74HV6lmHHz6YQPX18OGzPJsojkTTHStUgtZ2UCRTfqBLyfzts6aB/rflemJyAG0cydNl8QgMgKclAoUx+sgaPsRPc0GdUY97HhpG7tUUoe79bKeWoHUt/1viH7DfRNR7sLLDAoGBAPQUD9eni/VjmPCdotAIY+6MAwyizUhnObF1RR5geZTUNTbU9AF2vx/rIZm3yweOMPcSVQtDXVi7L2g1FRGjR/wPoqsiwN9pQEy18jsyJOigRHIRHuAQ9GfFZWnR+BEm2EqzUsgSJvae4Bo/m89gHJYp4aLTzOGQ4QKZlwsEo+TFAoGAFitD8VG5KKhGWPsxbDCSPcQSTqICxkV9zM2L0gPGCV+EdniiMi7b+WcGJJyuus/5U211OdB5WQoDiAy001GVBP6cyjTt/7UYq8C6Cwm9gh6oYGkGBm9Id3UOlWPL5DOcA+45Q1boTb+1Vfpft4yUcbcIKxRvuuBUp7aDaWScXpMCgYEA33IiUr4rDfohAF5/t82GltMM05uTLS57Da+bGEUf6RUgplLsEw7/x5u9hflRYFhXEUlyG76PDXVH4DGAWUZO1z4FIIDPa3fyioei+3hbe6+FGZv81QoQhZOb1PWJEUKrji9+oHSlwO8PoFgNLxsA8KPk0ejuTq4QoA21zjtwQzUCgYAQP6bmNOy9ah0MPcJhy68LkPx2yVTw+KGQZrkdt7dNqCSmW7BEPOKGiRlkx+2cgFHAehotUUH6nOBkEnVpUyAzkgyBOhDwSL8SmwRRdAn5SL+nQPMjKtHAmslS2LOaj6ii0kNrZrY3GALpCfgqO8jdONp7cz2RoHD646nmI3AM9A==-----END RSA PRIVATE KEY-----}
      - EXTERNAL_NETWORK_SERIALPORT=${EXTERNAL_NETWORK_SERIALPORT:-/dev/ttyUSB0}
      - EXTERNAL_NETWORK_BAUDRATE=${EXTERNAL_NETWORK_BAUDRATE:-115200}

      - SEND_STORED_DEVICE_MESSAGE_DELAY=${SEND_STORED_DEVICE_MESSAGE_DELAY:-30}
